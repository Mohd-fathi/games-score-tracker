<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ù†Ù‚Ø§Ø· - Mohd-Fathi</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="bg-gray-900 text-white font-sans" x-data="gameApp()" x-init="loadFromStorage()">

  <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
  <header class="text-center py-6 bg-gray-800 shadow-lg">
    <h1 class="text-3xl font-bold text-yellow-400">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø·</h1>
    <p class="text-sm text-gray-400">ØªØµÙ…ÙŠÙ…: Mohd-Fathi</p>
  </header>

  <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù„Ø¹Ø¨Ø© -->
  <main class="max-w-3xl mx-auto p-6">
    <div class="mb-6">
      <label class="block mb-2 font-semibold">Ø§Ø®ØªØ± Ø§Ù„Ù„Ø¹Ø¨Ø©:</label>
      <select x-model="selectedGame" @change="saveToStorage(); resetGame(false)" class="w-full p-2 rounded bg-gray-800 border border-gray-700">
        <option value="">-- Ø§Ø®ØªØ± --</option>
        <option value="domino">Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ†Ùˆ</option>
        <option value="harq">Ø§Ù„Ø­Ø±ÙŠÙ‚</option>
      </select>
    </div>

    <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‡Ø¯Ù Ù„Ù„Ø¯ÙˆÙ…ÙŠÙ†Ùˆ -->
    <template x-if="selectedGame === 'domino'">
      <div class="mb-6">
        <label class="block mb-2 font-semibold">Ø¥Ù„Ù‰ ÙƒÙ… ØªÙ„Ø¹Ø¨ØŸ</label>
        <select x-model="dominoTarget" @change="saveToStorage()" class="w-full p-2 rounded bg-gray-800 border border-gray-700">
          <option value="51">51</option>
          <option value="101">101</option>
        </select>
      </div>
    </template>

    <!-- Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† -->
    <div class="mb-6">
      <label class="block mb-2 font-semibold">Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨:</label>
      <div class="flex gap-2">
        <input x-model="singlePlayer" @keydown.enter.prevent="addPlayer"
               placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨"
               class="w-full p-2 rounded bg-gray-800 border border-gray-700">
        <button @click="addPlayer" class="px-4 py-2 bg-yellow-500 text-black font-semibold rounded-lg hover:bg-yellow-400 transition">â•</button>
      </div>
    </div>

    <!-- Ø¹Ø±Ø¶ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† -->
    <template x-if="players.length > 0">
      <div class="mb-6">
        <h3 class="font-semibold mb-2">Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†:</h3>
        <ul class="flex flex-wrap gap-2">
          <template x-for="(player, index) in players" :key="index">
            <li class="bg-gray-700 px-3 py-1 rounded-lg flex items-center gap-2">
              <span x-text="player.name"></span>
              <button @click="removePlayer(index)" class="text-red-400 hover:text-red-200 font-bold">âœ–</button>
            </li>
          </template>
        </ul>
      </div>
    </template>

    <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†Ù‚Ø§Ø· -->
    <template x-if="players.length > 0">
      <div>
        <table class="w-full text-center border-collapse">
          <thead>
            <tr class="bg-gray-800">
              <th class="p-2 border border-gray-700">Ø§Ù„Ù„Ø§Ø¹Ø¨</th>
              <th class="p-2 border border-gray-700">Ø§Ù„Ù†Ù‚Ø§Ø·</th>
              <th class="p-2 border border-gray-700">Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø§Ø·</th>
            </tr>
          </thead>
          <tbody>
            <template x-for="player in players" :key="player.name">
              <tr :class="{'bg-red-800': loser === player.name, 'bg-green-800': winner === player.name}">
                <td class="p-2 border border-gray-700" x-text="player.name"></td>
                <td class="p-2 border border-gray-700 font-bold" x-text="player.score"></td>
                <td class="p-2 border border-gray-700">
                  <input type="number" x-model.number="player.newScore"
                         class="w-20 p-1 rounded bg-gray-700 border border-gray-600">
                  <button @click="addScore(player)" class="ml-2 px-3 py-1 bg-green-500 text-black rounded hover:bg-green-400 transition">âœ”</button>
                </td>
              </tr>
            </template>
          </tbody>
        </table>
      </div>
    </template>

    <!-- Ø§Ù„Ù†ØªÙŠØ¬Ø© -->
    <div class="mt-6 text-center">
      <template x-if="loser">
        <p class="text-red-400 text-lg font-bold">âŒ Ø§Ù„Ø®Ø§Ø³Ø±: <span x-text="loser"></span></p>
      </template>
      <template x-if="winner">
        <p class="text-green-400 text-lg font-bold">ğŸ† Ø§Ù„ÙØ§Ø¦Ø²: <span x-text="winner"></span></p>
      </template>
    </div>

    <!-- Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· -->
    <div class="mt-6 text-center">
      <button @click="resetGame(true)" class="px-6 py-2 bg-blue-500 text-white font-semibold rounded-lg hover:bg-blue-400 transition">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·</button>
    </div>
  </main>

  <script>
    function gameApp() {
      return {
        selectedGame: "",
        dominoTarget: 51,
        players: [],
        loser: null,
        winner: null,
        singlePlayer: "",

        addPlayer() {
          if (this.singlePlayer.trim()) {
            this.players.push({ name: this.singlePlayer.trim(), score: 0, newScore: 0 });
            this.singlePlayer = "";
            this.loser = null;
            this.winner = null;
            this.saveToStorage();
          }
        },

        removePlayer(index) {
          this.players.splice(index, 1);
          this.loser = null;
          this.winner = null;
          this.saveToStorage();
        },

        addScore(player) {
          if (!player.newScore || player.newScore <= 0) return;
          player.score += player.newScore;
          player.newScore = 0;
          this.checkResult();
          this.saveToStorage();
        },

        checkResult() {
          let target = this.selectedGame === "domino" ? this.dominoTarget : 31;
          let loserPlayer = this.players.find(p => p.score >= target);
          if (loserPlayer) {
            this.loser = loserPlayer.name;
            let others = this.players.filter(p => p.name !== loserPlayer.name);
            let winnerPlayer = others.reduce((prev, curr) => prev.score < curr.score ? prev : curr, others[0]);
            this.winner = winnerPlayer ? winnerPlayer.name : null;
          }
        },

        resetGame(fullReset = false) {
          if (fullReset) {
            this.players = [];
            this.selectedGame = "";
            this.dominoTarget = 51;
          } else {
            this.players.forEach(p => { p.score = 0; p.newScore = 0; });
          }
          this.loser = null;
          this.winner = null;
          this.saveToStorage();
        },

        saveToStorage() {
          const data = {
            selectedGame: this.selectedGame,
            dominoTarget: this.dominoTarget,
            players: this.players,
            loser: this.loser,
            winner: this.winner
          };
          localStorage.setItem("gameAppData", JSON.stringify(data));
        },

        loadFromStorage() {
          const data = localStorage.getItem("gameAppData");
          if (data) {
            const parsed = JSON.parse(data);
            this.selectedGame = parsed.selectedGame || "";
            this.dominoTarget = parsed.dominoTarget || 51;
            this.players = parsed.players || [];
            this.loser = parsed.loser || null;
            this.winner = parsed.winner || null;
          }
        }
      }
    }
  </script>

</body>
</html>
